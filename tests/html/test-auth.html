<!DOCTYPE html>
<html>
<head>
    <title>Auth Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        button { margin: 5px; padding: 10px; }
        pre { background-color: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ShimmyServe Auth API Test</h1>
    
    <div class="test">
        <h2>1. Test Registration</h2>
        <button onclick="testRegister()">Register New User</button>
        <div id="register-result"></div>
    </div>
    
    <div class="test">
        <h2>2. Test Login</h2>
        <button onclick="testLogin()">Login</button>
        <div id="login-result"></div>
    </div>
    
    <div class="test">
        <h2>3. Test Token Verification</h2>
        <button onclick="testVerify()">Verify Token</button>
        <div id="verify-result"></div>
    </div>
    
    <div class="test">
        <h2>4. Test Refresh Token</h2>
        <button onclick="testRefresh()">Refresh Token</button>
        <div id="refresh-result"></div>
    </div>
    
    <script>
        let accessToken = null;
        let refreshToken = null;
        const API_URL = 'http://localhost:3001/api/auth';
        
        async function testRegister() {
            const randomEmail = `test${Date.now()}@example.com`;
            const result = document.getElementById('register-result');
            
            try {
                const response = await fetch(`${API_URL}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: randomEmail,
                        password: 'password123',
                        username: `user${Date.now()}`
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    accessToken = data.accessToken;
                    refreshToken = data.refreshToken;
                    result.innerHTML = '<div class="success">✓ Registration successful!</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    result.innerHTML = '<div class="error">✗ Registration failed!</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                result.innerHTML = '<div class="error">✗ Network error!</div>' +
                    '<pre>' + error.message + '</pre>';
            }
        }
        
        async function testLogin() {
            const result = document.getElementById('login-result');
            
            try {
                const response = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'test@example.com',
                        password: 'password123'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    accessToken = data.accessToken;
                    refreshToken = data.refreshToken;
                    result.innerHTML = '<div class="success">✓ Login successful!</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    result.innerHTML = '<div class="error">✗ Login failed!</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                result.innerHTML = '<div class="error">✗ Network error!</div>' +
                    '<pre>' + error.message + '</pre>';
            }
        }
        
        async function testVerify() {
            const result = document.getElementById('verify-result');
            
            if (!accessToken) {
                result.innerHTML = '<div class="error">✗ No access token! Login first.</div>';
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/verify`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = '<div class="success">✓ Token is valid!</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    result.innerHTML = '<div class="error">✗ Invalid token!</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                result.innerHTML = '<div class="error">✗ Network error!</div>' +
                    '<pre>' + error.message + '</pre>';
            }
        }
        
        async function testRefresh() {
            const result = document.getElementById('refresh-result');
            
            if (!refreshToken) {
                result.innerHTML = '<div class="error">✗ No refresh token! Login first.</div>';
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/refresh`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        refreshToken: refreshToken
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    accessToken = data.accessToken;
                    refreshToken = data.refreshToken;
                    result.innerHTML = '<div class="success">✓ Token refreshed!</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    result.innerHTML = '<div class="error">✗ Refresh failed!</div>' +
                        '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                result.innerHTML = '<div class="error">✗ Network error!</div>' +
                    '<pre>' + error.message + '</pre>';
            }
        }
    </script>
</body>
</html>